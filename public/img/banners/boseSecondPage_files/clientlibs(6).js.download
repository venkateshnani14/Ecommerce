var Bose=Bose||{};Bose.ProductComparisonDrawer=function(){function a(){var a=$jq(document),f="";$jq(p.comparisonDrawer).length&&(D=$jq(p.addToCompareHideCheckbox),f=$jq(p.containerDiv).clone(),D.length&&D.addClass(q.addToCompareCheckbox).removeClass(q.addToCompareHidden),a.on("click",p.compareCheckbox,b).on("click",p.compareButton,g).on("click",p.accordionHeader,k).on("scroll",o).on("analyticsUpdateProductTile",h).on("transitionend",p.tilesContainer,m).on("transitionstart",p.tilesContainer,l).on("transitionstart",p.errorDiv,i).on("transitionend",p.errorDiv,j),Gridle.isActive("large")?a.on("click",p.removeIcon,e):a.on("click",p.productDrawerTile,e),z=Bose.Translation.getSiteTranslation("REMOVE_FROM_COMPARE"),A=Bose.Translation.getSiteTranslation("ADD_TO_COMPARE"),f.insertBefore($jq("footer")),$jq(p.containerDiv)[0].remove(),Bose.WebStorage.getData("productComparisonDrawer","sessionStorage")&&(t=[],w=JSON.parse(Bose.WebStorage.getData("productComparisonDrawer","sessionStorage"))),w?w.forEach(function(a){$jq(p.products).each(function(){if(B=$jq(this),JSON.parse(B.attr("data-commerce")).mainproduct.trim()===a.id.trim())return B.find(p.checkboxSelector).prop("checked","true"),B.find(p.addToCompareSelector).addClass("checked"),!1}),r++,t.push({id:a.id,url:a.url,title:a.title,buyUrl:a.buyUrl,trackingInfo:a.trackingInfo,trackingCommerce:a.trackingCommerce}),x=Bose.WebStorage.getData("compareTableCategory","sessionStorage"),v=JSON.stringify(t),Bose.WebStorage.storeData("productComparisonDrawer",v,"sessionStorage"),C=!0,d(0,!0),c(!1)}):t=[])}function b(){var a=$jq(this),b=a.closest(".bose-productTile2020"),e=JSON.parse(b.attr("data-commerce")).mainproduct.trim(),g=b.find(".bose-productTile2020__imageWrapper").find("img").attr("data-src"),h=b.find(".bose-productTile2020__imageWrapper").find("img").attr("title"),i=a.closest(".bose-productTile2020__addToCompare"),j=$jq(p.similarProductsMsg),k=$jq(p.maxProductsMsg),l=b.data("tracking-info"),m=JSON.parse(b.attr("data-commerce")),n=b.find(".bose-productTile2020__imageWrapper").find("a").attr("href");r||(x=b.data("category"),Bose.WebStorage.storeData("compareTableCategory",x,"sessionStorage")),a.is(":checked")&&r<4&&b.data("category")!==x?(a.prop("checked",!1),f(k,j)):a.is(":checked")&&r<4?(i.addClass("checked"),r++,i.find(p.screenReaderText).text(z),i.find(p.productTilecheckBox).attr("aria-checked",!0),a.closest(p.productTilecheckBox).blur(),t.push({id:e,url:g,title:h,buyUrl:n,trackingInfo:l,trackingCommerce:m}),v=JSON.stringify(t),Bose.WebStorage.storeData("productComparisonDrawer",v,"sessionStorage"),d(0,!0),c(!1)):a.is(":checked")&&r>=4?(a.prop("checked",!1),f(j,k),a.closest(p.productTilecheckBox).blur()):(r--,i.removeClass("checked"),i.find(p.screenReaderText).text(A),i.find(p.productTilecheckBox).attr("aria-checked",!1),a.closest(p.productTilecheckBox).blur(),$jq.each(t,function(a,b){if(b.id===e)return t.splice(a,1),v=JSON.stringify(t),Bose.WebStorage.storeData("productComparisonDrawer",v,"sessionStorage"),d(a,!1),c(!0),!1}))}function c(a){var b=$jq(p.tilesContainer),c=$jq(p.comparisonDrawer),d=$jq(p.info),e=$jq(p.compareButton);a&&Gridle.isActive("small")&&r>=1&&"214px"!==b.css("max-height")&&m("deleted"),r<2?(e.addClass("-disabled"),e.attr("aria-disabled","true")):(e.removeClass("-disabled"),e.attr("aria-disabled","false")),$jq(p.accordionHeader).find(".bose-productComparisonDrawer__productCount").text("("+r+")"),a&&0===r?(c.css("max-height","0"),Gridle.isActive("small")&&b.css("max-height","0"),n("0","0","0")):a||1!==r||(n("67px","169px","82px"),$jq(p.title).text("Compare "+x),Gridle.isActive("small")?!0===C?c.css("max-height","365px"):(d.addClass("showInfo"),u=0,c.css("max-height","365px"),b.css("max-height","214px")):Gridle.isActive("medium")?c.css("max-height","220px"):c.css("max-height","132px")),C=!1}function d(a,b){var c=$jq(p.productDrawerTile).eq(r-1),d=$jq(p.productDrawerTile).eq(a),e=$jq(p.tilesContainer),f="",g="",h="",i="";b?(i=Bose.Translation.getSiteTranslation(t[r-1].title),f=c.find(p.imageWrapper),h=f.find(p.removeIcon),c.find(p.image).attr({src:t[r-1].url,alt:i}),h.attr("aria-label",z+i),c.data("id",t[r-1].id),f.addClass("bose-productComparisonDrawer__imageWrapper-opaque"),g=c.find(p.imageWrapperLink),g.removeClass("hide").attr({href:t[r-1].buyUrl,title:i,"data-tracking-info":JSON.stringify(t[r-1].trackingInfo),"data-tracking-commerce":JSON.stringify(t[r-1].trackingCommerce)}),c.find(p.removeIcon).show(),Gridle.isActive("small")&&1!==r&&"214px"!==e.css("max-height")&&!1===C&&m("added")):(d.find(p.image).attr({src:"",alt:""}),g=d.find(p.imageWrapperLink),g.addClass("hide"),d.data("id",""),d.find(p.imageWrapper).removeClass("bose-productComparisonDrawer__imageWrapper-opaque"),d.find(p.removeIcon).hide(),d.remove().insertBefore(".js-bose-drawerCompareButton"))}function e(){var a=$jq(this).closest(p.productDrawerTile),b=a.data("id");b&&(r--,$jq.each(t,function(a,e){if(e.id===b)return t.splice(a,1),v=JSON.stringify(t),Bose.WebStorage.storeData("productComparisonDrawer",v,"sessionStorage"),c(!0),d(a,!1),!1}),$jq(p.products).each(function(){var a=$jq(this);if(JSON.parse(a.attr("data-commerce")).mainproduct.trim()===b)return a.find(".js-productTile2020__checkBox").prop("checked",!1),a.find(".bose-productTile2020__addToCompare").removeClass("checked"),a.find(".bose-productTile2020__addToCompare .bose-screenReaderText").text(A),!1}))}function f(a,b){var c=$jq(p.errorDiv);c.hasClass(p.animatedErrorDiv)||(a.hasClass(p.flexy)&&a.removeClass(p.flexy),b.addClass(p.flexy),y=0,c.css("max-height","42px"),c.addClass(p.animatedErrorDiv))}function g(a){if(a.preventDefault(),r>=2){var b=$jq(p.compareButton);s=b[0].href;var c="?";if(t)for(var d=0;d<t.length;d++)c+=(0===d?"products=":",")+t[d].id;s+=c,b.attr("href",s),v=JSON.stringify(t),window.location.href=s}}function h(){if(D=$jq(p.addToCompareHideCheckbox),D.length&&D.addClass(q.addToCompareCheckbox).removeClass(q.addToCompareHidden),t){var a="",b="",c=$jq(p.products);t.forEach(function(d){for(var e=0;e<c.length;e++)a=c.eq(e),b=a.find(p.addToCompareSelector),b.hasClass("checked")||d.id.trim()!==JSON.parse(a.attr("data-commerce")).mainproduct.trim()||(a.find(p.checkboxSelector).prop("checked","true"),b.addClass("checked"))})}o()}function i(){var a=$jq(p.errorDiv);0===y?y=1:(a.removeClass(p.animatedErrorDiv),y=0)}function j(){var a=$jq(p.errorDiv);a.css("transition-delay","0s"),0===y?y=1:(a.css("transition-delay","3s"),a.css("max-height","0"))}function k(){if(Gridle.isActive("small")){var a=$jq(p.tilesContainer),b=$jq(p.info);a.hasClass("flexy")?(u=1,a.removeClass("flexy").css("max-height","0")):"0px"===a.css("max-height")&&(u=2,a.addClass("flexy").css("max-height","214px"),$jq(p.accordionHeader).find(p.accordionIcon).toggleClass("bose-productComparisonDrawer__accordionIcon-closed"),b.addClass("showInfo"))}}function l(){var a=$jq(p.info);Gridle.isActive("small")&&(0===u?(a.addClass("showInfo"),$jq(p.accordionHeader).find(p.accordionIcon).toggleClass("bose-productComparisonDrawer__accordionIcon-closed")):2!==u&&(a.removeClass("showInfo"),$jq(p.accordionHeader).find(p.accordionIcon).toggleClass("bose-productComparisonDrawer__accordionIcon-closed")))}function m(a){var b=$jq(p.tilesContainer);Gridle.isActive("small")&&(b.css("transition-delay","0s"),"added"===a||"deleted"===a?(u=0,b.addClass("flexy").css("max-height","214px")):0===u&&(u=1,b.css("transition-delay","2s"),b.removeClass("flexy").css("max-height","0")))}function n(a,b,c){var d=$jq(p.containerDiv);d.length&&(Gridle.isActive("small")?d.css("margin-top",a):Gridle.isActive("medium")?d.css("margin-top",b):d.css("margin-top",c))}function o(){var a=$jq(p.comparisonDrawer);Gridle.isActive("small")&&2===u&&"214px"===$jq(p.tilesContainer).css("max-height")&&k(),$jq(p.footer).offset()&&a.offset()&&a.height()+a.offset().top>=$jq(p.footer).offset().top?a.css("position","absolute"):$jq(p.footer).offset()&&$jq(document).scrollTop()+window.innerHeight<$jq(p.footer).offset().top&&a.css("position","fixed")}var p={accordionHeader:".js-bose-productComparisonDrawer__inner-headings",containerDiv:".js-bose-productComparisonDrawerContainer",aemParentDiv:".productComparisonDrawer",comparisonDrawer:".js-bose-productComparisonDrawer",tilesContainer:".js-bose-productComparisonDrawer__inner-tilesContainer",info:".js-bose-productComparisonDrawer__inner-headings--info",compareCheckbox:".bose-productTile2020 .bose-productTile2020__addToCompare .js-productTile2020__checkBox",productDrawerTile:".js-bose-productComparisonDrawer__inner-tilesContainer--tiles",compareButton:".bose-productComparisonDrawer .bose-buttonLink--compare",removeIcon:".js-bose-productComparisonDrawer__removeIcon",products:".bose-productTile2020",accordionIcon:".bose-productComparisonDrawer__accordionIcon",footer:".bose-footer",errorDiv:".js-bose-productComparisonDrawer__errorDiv",animatedErrorDiv:"bose-productComparisonDrawer__errorDiv-animation",maxProductsMsg:".bose-productComparisonDrawer__errorDiv-maxProductsMsg",similarProductsMsg:".bose-productComparisonDrawer__errorDiv-similarProductsMsg",imageWrapper:".bose-productComparisonDrawer__imageWrapper",image:".bose-productComparisonDrawer__imageWrapper-image",price:".bose-productPriceSummary.bose-productTile2020__info__price",colorIndicator:".bose-colorIndicator",title:".js-bose-productComparisonDrawer__inner-headings--title",flexy:"bose-productComparisonDrawer__errorDiv-flexy",screenReaderText:".bose-screenReaderText",productTilecheckBox:".bose-productTile2020__checkBox",checkboxSelector:".js-productTile2020__checkBox",addToCompareSelector:".bose-productTile2020__addToCompare",addToCompareHideCheckbox:".bose-productTile2020__addToCompare--hide",imageWrapperLink:".bose-productComparisonDrawer__imageWrapper-link"},q={addToCompareCheckbox:"bose-productTile2020__addToCompare",addToCompareHidden:"bose-productTile2020__addToCompare--hide"},r=0,s="",t={},u=0,v="",w="",x="",y=0,z="",A="",B="",C=!1,D="";return{init:a,_selectors:p,_productCount:r,_checkOffset:o}}();
$jq(document).ready(function(){Bose.ProductComparisonDrawer.init()});
