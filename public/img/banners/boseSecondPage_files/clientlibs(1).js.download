var Bose=Bose||{};Bose.Select=Bose.Select||{},Bose.Select.selectors={container:".bose-select",field:".bose-select__native",labelClass:".bose-select__label",caretDown:"bose-icon bose-icon--carretDown -color",caretUp:"bose-icon bose-icon--carretUp -color",allowedStates:".js-bose-allowedStates"},Bose.Select.classes={active:"bose-select--active",error:"bose-select--error js-errorValidate",valid:"bose-select--valid",disabled:"bose-select--disabled"},Bose.Select.validators={date:"DATE",date18Plus:"DATE_OLDER_THEN_18"},Bose.Select.selectedFields={expiryMonth:!1,expiryYear:!1},Bose.Select.keyCodes=[$jq.ui.keyCode.UP,$jq.ui.keyCode.DOWN],Bose.Select.defaultValue="-1",Bose.Select.init=function(a){var b;Bose.Select.selectedFields={expiryMonth:!1,expiryYear:!1},b=a?a.find("select"+Bose.Select.selectors.field+":not([data-initialized])"):$jq("select"+Bose.Select.selectors.field+":not([data-initialized])"),$jq.each(b,function(a,b){var c=$jq(b);c.attr("tabindex","-1"),Bose.Select.initSelect(c)}),$jq(Bose.Select.selectors.labelClass).on("click",Bose.Select.openAndFocus),b.on("focus",Bose.Select.setActive).on("focus",Bose.Select.triggerFocus).on("blur",Bose.Select.leave).on("change",Bose.Select.triggerFormFieldCompleted).on("blur paste",Bose.Select.doValidation).on("change input propertychange",Bose.Select.doChange).bind("setDisabled",Bose.Select.disableField).bind("setEnabled",Bose.Select.enableField).bind("doValidation",Bose.Select.doValidation),window.onpopstate=Bose.Select.closeSelect,b.closest(Bose.Select.selectors.container).filter(".bose-select--error").find(Bose.Select.selectors.field).each(function(){var a,b=$jq(this);void 0!==b.data("options")&&(a=b.data("options").messages.validationMessage,Bose.Select.markInvalid(b.closest(Bose.Select.selectors.container),a))})},Bose.Select.disableField=function(){$jq(this).selectmenu("option","disabled",!0),$jq(this).closest(Bose.Select.selectors.container).addClass(Bose.Select.classes.disabled)},Bose.Select.enableField=function(){$jq(this).selectmenu("option","disabled",!1),$jq(this).closest(Bose.Select.selectors.container).removeClass(Bose.Select.classes.disabled)},Bose.Select.initSelect=function(a){var b=a.find("option[selected]").val(),c=a.val();void 0!==b&&b!==c&&a.val(b),Bose.Select.initDefault(a),"disabled"===a.data("element-disabled")&&Bose.Select.disableField.call(a)},Bose.Select.leave=function(){var a=$jq(this),b=a.closest(Bose.Select.selectors.container);Bose.Tooltip.hide(b)},Bose.Select.markValid=function(a){a.removeClass(Bose.Select.classes.error).removeClass(Bose.Select.classes.active).addClass(Bose.Select.classes.valid),Bose.Select.setOk(a.closest(".bose-select"))},Bose.Select.markInvalid=function(a,b){a.removeClass(Bose.Select.classes.valid).removeClass(Bose.Select.classes.active).addClass(Bose.Select.classes.error),"payment.expiryMonth"!==a.context.name&&"payment.expiryYear"!==a.context.name||!a.parent().closest(".js-bose-cardDetails").data("cardexpired")?(a.next(".bose-newErrorMessage").html(b),Bose.Select.setError(a.closest(".bose-select","errorMessage"))):(a.closest(".js-bose-cardDetails").find(".bose-error__expiredMessage").html(b),Bose.Select.setError(a.closest(".bose-select","errorMessage"))),$jq(document).trigger("analyticsFormError",[a,b])},Bose.Select.resetState=function(a){a.removeClass("bose-select--error bose-select--valid bose-select--active"),a.find("span.bose-select__error-message").html("")},Bose.Select.isValid=function(a){var b=a.closest(Bose.Select.selectors.container);return!b.is(":visible")||!b.hasClass(Bose.Select.classes.error)},Bose.Select.doValidation=function(){var a=$jq(this),b=a.closest(Bose.Select.selectors.container);if(b.hasClass("bose-select--readOnly"))return void Bose.Select.resetState(b);"payment.expiryMonth"===a.attr("name")?Bose.Select.selectedFields.expiryMonth=!0:"payment.expiryYear"===a.attr("name")&&(Bose.Select.selectedFields.expiryYear=!0),Bose.Select.validationNeeded(a)&&Bose.Select.doRequiredCheck(a,b)&&Bose.Select.doCvvCheck(a,b)&&Bose.Select.doDateFieldCheck(a,b)&&Bose.Select.markValid(b)},Bose.Select.validationNeeded=function(a){var b=a.data("options");return!(void 0===a.attr("required")&&void 0===b||!(b.ccDate&&"false"!==b.ccDate||void 0!==b.validator))},Bose.Select.doRequiredCheck=function(a,b){var c=$jq($jq('[name="payment.expiryMonth"]:not([disabled="disabled"])')[0]),d=$jq($jq('[name="payment.expiryYear"]:not([disabled="disabled"])')[0]),e=a.attr("name")===c.attr("name")?d:c,f=e.closest(Bose.Select.selectors.container);if(void 0!==a.attr("required")&&(""===a.val()||"-1"===a.val())){var g=a.data("options").messages.required;return b.closest(".js-bose-cardDetails").length>0&&Bose.Select.selectedFields.expiryMonth&&Bose.Select.selectedFields.expiryYear&&f.length>0?(Bose.Select.setActive.call(f),b.closest(".js-bose-cardDetails").data("cardexpired",!0),b.closest(".js-bose-cardDetails").find(".bose-error__expiredMessage").hide(),Bose.Select.markInvalid(f,e.data("options").messages.required),Bose.Select.markInvalid(b,g)):0===b.closest(".js-bose-cardDetails").length&&Bose.Select.markInvalid(b,g),!1}return void 0===b||!b||!0!==b.closest(Bose.Select.selectors.allowedStates).data("invalid-selection")},Bose.Select.doCvvCheck=function(a,b){var c=a.data("options");if(void 0!==c&&c.ccDate&&"false"!==c.ccDate){var d=$jq($jq('[name="payment.expiryMonth"]:not([disabled="disabled"])')[0]),e=$jq($jq('[name="payment.expiryYear"]:not([disabled="disabled"])')[0]),f=parseInt(d.val(),10),g=parseInt(e.val(),10),h=new Date(g,f-1),i=new Date,j=a.attr("name")===d.attr("name")?e:d,k=j.closest(Bose.Select.selectors.container);if(-1!==g&&-1!==f&&(i.getYear()<h.getYear()||i.getYear()===h.getYear()&&i.getMonth()<=h.getMonth()))return Bose.Select.setActive.call(k),b.closest(".js-bose-cardDetails").data("cardexpired",!1),Bose.Select.markValid(k),!0;if(Bose.Select.selectedFields.expiryMonth&&Bose.Select.selectedFields.expiryYear&&-1!==g&&-1!==f&&k.length>0)return Bose.Select.setActive.call(k),b.closest(".js-bose-cardDetails").data("cardexpired",!0),Bose.Select.markInvalid(k,j.data("options").messages.ccDate),Bose.Select.markInvalid(b,c.messages.ccDate),!1;if(Bose.Select.selectedFields.expiryMonth&&Bose.Select.selectedFields.expiryYear&&(-1!==g||-1!==f)&&k.length>0)return Bose.Select.setActive.call(k),b.closest(".js-bose-cardDetails").data("cardexpired",!0),Bose.Select.markInvalid(k,j.data("options").messages.required),Bose.Select.markInvalid(b,c.messages.required),!1}return!0},Bose.Select.doDateFieldCheck=function(a){var b=a.data("options");if(void 0!==b&&b.validator&&-1!==b.validator.indexOf(Bose.Select.validators.date)){var c=a.closest(".bose-dateFields"),d=c.find('[name*="birthdayDay"]'),e=c.find('[name*="birthdayMonth"]'),f=c.find('[name*="birthdayYear"]'),g=d.val(),h=e.val(),i=f.val(),j=b.validator!==Bose.Select.validators.date18Plus;if(!("-1"===g&&"-1"===h&&"-1"===i||"-1"!==i&&j)){var k;return j||(k=d.data("options").messages.validationMessage),Bose.Select.markInvalid(d.closest(Bose.Select.selectors.container),k),Bose.Select.markInvalid(e.closest(Bose.Select.selectors.container),k),Bose.Select.markInvalid(f.closest(Bose.Select.selectors.container),k),!1}Bose.Select.markValid(d.closest(Bose.Select.selectors.container)),Bose.Select.markValid(e.closest(Bose.Select.selectors.container)),Bose.Select.markValid(f.closest(Bose.Select.selectors.container))}return!0},Bose.Select.close=function(){var a=$jq(this),b=a.closest(Bose.Select.selectors.container);a.selectmenu("option","icons",{button:Bose.Select.selectors.caretDown}),a.closest(Bose.Select.selectors.container).find(Bose.Select.selectors.labelClass).on("click",Bose.Select.openAndFocus),Bose.Select.doValidation.bind(a),Bose.Tooltip.hide(b)},Bose.Select.openAndFocus=function(){var a=$jq(this).parent(".bose-select").find(Bose.Select.selectors.field);Gridle.isActive("large")&&a.selectmenu().selectmenu("open").selectmenu("menuWidget").focus()},Bose.Select.open=function(){var a=$jq(this),b=a.closest(Bose.Select.selectors.container);a.selectmenu("option","icons",{button:Bose.Select.selectors.caretUp}),b.find(Bose.Select.selectors.labelClass).off("click",Bose.Select.openAndFocus),Bose.Tooltip.show(b)},Bose.Select.setActive=function(){var a=$jq(this);a.parent().hasClass(Bose.Select.classes.active)||a.val()===Bose.Select.defaultValue?a.val()===Bose.Select.defaultValue&&a.parent().removeClass(Bose.Select.classes.active):a.parent().addClass(Bose.Select.classes.active)},Bose.Select.setActiveLabel=function(){$jq(Bose.Select.selectors.field).each(function(){$jq(this).val()&&$jq(this).val()!==Bose.Select.defaultValue&&$jq(this).parents(Bose.Select.selectors.container).addClass(Bose.Select.classes.active)})},Bose.Select.initDefault=function(a){var b=$jq.ui.selectmenu.prototype._buttonEvents.keydown;$jq.ui.selectmenu.prototype._buttonEvents.keydown=function(a){-1!==$jq.inArray(a.keyCode,Bose.Select.keyCodes)&&$jq(a.currentTarget).hasClass("ui-corner-all")&&this.element.selectmenu("open"),b.call(this,a)},a.find("option:selected").val()!==Bose.Select.defaultValue&&void 0!==a.attr("required")&&a.find('option[value="-1"]').remove();var c=a.selectmenu();if(c.selectmenu("option","icons",{button:Bose.Select.selectors.caretDown}),c.selectmenu("option","close",Bose.Select.close.bind(c)),c.selectmenu("option","open",Bose.Select.open.bind(c)),c.selectmenu("option","select",Bose.Select.doChange.bind(c)),c.selectmenu("option","change",Bose.Select.triggerChangeMenu.bind(c)),c.selectmenu("widget").addClass("bose-select__select"),c.selectmenu("widget").off("blur").on("blur",Bose.Select.triggerStateChange),c.selectmenu("menuWidget").addClass("bose-selectFoldout"),c.hasClass("bose-custom-select")){c.selectmenu("menuWidget").addClass("bose-custom-select-ul");var d=c.parent().width();d>0&&c.selectmenu("menuWidget").css({"max-width":d})}return Bose.Select.setActive.call(c),c.attr("data-initialized",!0),c},window.onresize=function(){var a=$jq(".bose-custom-select"),b=$jq(".bose-custom-select-ul");if(window.innerWidth>=300&&a&&b){var c=a.parent().width();c>0&&b.css({"max-width":c})}},Bose.Select.triggerChangeMenu=function(){Bose.Select.doChange.bind($jq(this)),Bose.Select.triggerFormFieldCompleted.call($jq(this))},Bose.Select.triggerFormFieldCompleted=function(a,b){var c=$jq(this).closest(Bose.Select.selectors.container);void 0===b&&"-1"!==$jq(this).val()&&$jq(document).trigger("analyticsFormFieldChangeSelect",[c])},Bose.Select.doChange=function(){Bose.Select.setActive.call($jq(this)),Bose.Select.doValidation.call($jq(this))},Bose.Select.triggerStateChange=function(){$jq(this).closest(Bose.Select.selectors.container).find("select.js-state").trigger("change",["blur"])},Bose.Select.setOk=function(a){a.removeClass(Bose.Select.classes.error).find(".bose-icon").addClass("bose-icon--ok"),a.closest("js-bose-cardDetails").attr("data-cardexpired",!1),a.next(".bose-newErrorMessage").removeClass("-show"),a.closest(".js-bose-cardDetails").find(".bose-error__expiredMessage").hide()},Bose.Select.setError=function(a){a.addClass(Bose.Select.classes.error).find(".bose-icon").removeClass("bose-icon--ok"),void 0!==a.closest(".js-bose-cardDetails")&&a.closest(".js-bose-cardDetails").data("cardexpired")?(a.next(".bose-newErrorMessage").removeClass("-show"),a.closest(".js-bose-cardDetails").find(".bose-error__expiredMessage").css("display","inline-block")):(a.closest("js-bose-cardDetails").attr("data-cardexpired",!1),a.next(".bose-newErrorMessage").addClass("-show"))},Bose.Select.closeSelect=function(){$jq(".bose-select__native").each(function(){var a=$jq(this);a.selectmenu("instance")&&a.data("initialized")&&(a.selectmenu("close"),a.selectmenu("option","icons",{button:Bose.Select.selectors.caretDown}))})},Bose.Select.resetSelectMenuToNative=function(){var a=$jq("select"+Bose.Select.selectors.field);a.length>0&&(Gridle.isActive("small")||Gridle.isActive("medium"))&&$jq.each(a,function(a,b){var c=$jq(b);c.parent().addClass("bose-select--nativeContainer"),c.selectmenu(),c.selectmenu("destroy")})},Bose.Select.refresh=function(a){var b=a.closest(Bose.Select.selectors.container);a.length&&(a.each(function(){this.selectedIndex=0}),a.selectmenu("instance")&&a.selectmenu("refresh"),b.removeClass(Bose.Select.classes.error+" "+Bose.Select.classes.active),Bose.Select.setOk(b.closest(".bose-select")))};
$jq(document).ready(function(){Bose.Select.init()});
